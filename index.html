<script>
    captureButton.addEventListener('click', async () => {
        const context = canvas.getContext('2d');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        context.drawImage(video, 0, 0, canvas.width, canvas.height);
        
        // ပုံကို Blob အဖြစ် ပြောင်းလဲခြင်း
        canvas.toBlob(async (blob) => {
            const formData = new FormData();
            formData.append('chat_id', window.Telegram.WebApp.initDataUnsafe.user.id);
            formData.append('photo', blob, 'capture.jpg');
            formData.append('caption', 'User ဆီမှ ရရှိသော ပုံဖြစ်ပါသည်။');

            status.innerText = "ပုံပို့နေသည်... ခေတ္တစောင့်ပါ။";

            try {
                // Telegram API ဆီ တိုက်ရိုက်ပို့ခြင်း
                const response = await fetch(`https://api.telegram.org/bot8396307053:AAEH_oUAbyiTjNaq997drQkIHQ6keghM6xw/sendPhoto`, {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    status.innerText = "အောင်မြင်စွာ ပို့ပြီးပါပြီ။";
                    setTimeout(() => window.Telegram.WebApp.close(), 1000);
                } else {
                    status.innerText = "ပို့၍မရပါ။ Bot Token မှားနေနိုင်ပါသည်။";
                }
            } catch (err) {
                status.innerText = "Error: " + err;
            }
        }, 'image/jpeg');
    });
</script>
